<!DOCTYPE html>
<html>
<head>
    <title>Professional Image to PDF Converter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: Arial;
            background: #f4f4f4;
            padding: 30px;
            text-align: center;
        }

        .container {
            background: white;
            padding: 25px;
            border-radius: 10px;
            max-width: 900px;
            margin: auto;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }

        .upload-area {
            border: 2px dashed #888;
            padding: 30px;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .upload-area.dragover {
            background: #e3f2fd;
        }

        .preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }

        .preview img {
            width: 120px;
            border-radius: 6px;
        }

        .settings {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        button {
            padding: 10px 20px;
            margin-top: 15px;
            cursor: pointer;
            border: none;
            background: #1976d2;
            color: white;
            border-radius: 5px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ddd;
            margin-top: 15px;
            display: none;
        }

        .progress-fill {
            height: 100%;
            width: 0%;
            background: #1976d2;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>Image to PDF Converter</h2>

    <div class="upload-area" id="uploadArea">
        Click or Drag & Drop Images Here
    </div>

    <input type="file" id="fileInput" multiple accept="image/*" hidden>

    <div class="settings">
        <div>
            <label>Page Size</label>
            <select id="pageSize">
                <option value="a4">A4</option>
                <option value="letter">Letter</option>
                <option value="a3">A3</option>
            </select>
        </div>

        <div>
            <label>Orientation</label>
            <select id="orientation">
                <option value="p">Portrait</option>
                <option value="l">Landscape</option>
            </select>
        </div>

        <div>
            <label>Margin (mm)</label>
            <input type="number" id="marginInput" value="10" min="0" max="50">
        </div>

        <div>
            <label>Image Quality: <span id="qualityValue">1.0</span></label>
            <input type="range" id="qualityRange" min="0.1" max="1" step="0.1" value="1">
        </div>
    </div>

    <button id="convertBtn">Convert to PDF</button>

    <div class="progress-bar" id="progressBar">
        <div class="progress-fill"></div>
    </div>

    <div class="preview" id="previewContainer"></div>
</div>

<script>

const uploadArea = document.getElementById('uploadArea');
const fileInput = document.getElementById('fileInput');
const previewContainer = document.getElementById('previewContainer');
const convertBtn = document.getElementById('convertBtn');
const progressBar = document.getElementById('progressBar');
const qualityRange = document.getElementById('qualityRange');
const qualityValue = document.getElementById('qualityValue');
const pageSizeSelect = document.getElementById('pageSize');
const orientationSelect = document.getElementById('orientation');
const marginInput = document.getElementById('marginInput');

let selectedFiles = [];
let imageQuality = 1.0;

uploadArea.addEventListener('click', () => fileInput.click());

uploadArea.addEventListener('dragover', e => {
    e.preventDefault();
    uploadArea.classList.add('dragover');
});

uploadArea.addEventListener('dragleave', () => {
    uploadArea.classList.remove('dragover');
});

uploadArea.addEventListener('drop', e => {
    e.preventDefault();
    uploadArea.classList.remove('dragover');
    handleFiles(e.dataTransfer.files);
});

fileInput.addEventListener('change', e => {
    handleFiles(e.target.files);
});

qualityRange.addEventListener('input', () => {
    imageQuality = parseFloat(qualityRange.value);
    qualityValue.textContent = imageQuality.toFixed(1);
});

function handleFiles(files) {
    const images = Array.from(files).filter(f => f.type.startsWith('image/'));
    selectedFiles = [...selectedFiles, ...images];
    updatePreview();
}

function updatePreview() {
    previewContainer.innerHTML = '';
    selectedFiles.forEach(file => {
        const reader = new FileReader();
        reader.onload = e => {
            const img = document.createElement('img');
            img.src = e.target.result;
            previewContainer.appendChild(img);
        };
        reader.readAsDataURL(file);
    });
}

convertBtn.addEventListener('click', async () => {

    if (selectedFiles.length === 0) {
        alert("Select images first");
        return;
    }

    progressBar.style.display = "block";
    const progressFill = document.querySelector('.progress-fill');

    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF(
        orientationSelect.value,
        "mm",
        pageSizeSelect.value
    );

    const margin = parseFloat(marginInput.value) || 0;

    for (let i = 0; i < selectedFiles.length; i++) {

        const file = selectedFiles[i];

        await new Promise(resolve => {

            const reader = new FileReader();

            reader.onload = e => {

                const img = new Image();

                img.onload = () => {

                    if (i > 0) {
                        pdf.addPage(pageSizeSelect.value, orientationSelect.value);
                    }

                    const pageWidth = pdf.internal.pageSize.getWidth();
                    const pageHeight = pdf.internal.pageSize.getHeight();

                    const usableWidth = pageWidth - margin * 2;
                    const usableHeight = pageHeight - margin * 2;

                    const imgRatio = img.width / img.height;
                    const pageRatio = usableWidth / usableHeight;

                    let renderWidth, renderHeight;

                    if (imgRatio > pageRatio) {
                        renderWidth = usableWidth;
                        renderHeight = usableWidth / imgRatio;
                    } else {
                        renderHeight = usableHeight;
                        renderWidth = usableHeight * imgRatio;
                    }

                    const x = (pageWidth - renderWidth) / 2;
                    const y = (pageHeight - renderHeight) / 2;

                    pdf.addImage(
                        e.target.result,
                        "JPEG",
                        x,
                        y,
                        renderWidth,
                        renderHeight,
                        undefined,
                        "SLOW",
                        imageQuality
                    );

                    progressFill.style.width =
                        ((i + 1) / selectedFiles.length) * 100 + "%";

                    resolve();
                };

                img.src = e.target.result;
            };

            reader.readAsDataURL(file);
        });
    }

    pdf.save("converted.pdf");

    progressBar.style.display = "none";
    progressFill.style.width = "0%";
});

</script>

</body>
</html>
